<!doctype html>
<html lang="pt">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Inventario Firebase</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">

          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
          <style>
            th
            {
              vertical-align: middle;
            }
            #cc
            {
              position: relative;
              top: 4px;
            }
          </style>
  <script type="text/javascript" src="https://tiiny.host/ad-script.js"></script><script defer data-domain="ifcodex.tiiny.site" src="https://analytics.tiiny.site/js/plausible.js"></script></head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
            crossorigin="anonymous"></script>

    

    <table class = "table table-dark table-striped">
        <thead>
            <th>Num</th>
            <th>Local</th>
            <th>Nome</th>
            <th>Tag ID</th>
            <th>Patrimonio</th>
            <th><span>Controle</span> <button class = "btn btn-light ms-3"><i class="fa-solid fa-circle-plus"></i></button></th>
        </thead>

        <tbody id = "tbody1">
        </tbody>
    </table>



    <script type="module">

        //configuração do firebase

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyAf0ubkUu9w0gJxshU7Lu78LGFlN3_QjcA",
          authDomain: "inventario-c50f8.firebaseapp.com",
          databaseURL: "https://inventario-c50f8-default-rtdb.firebaseio.com",
          projectId: "inventario-c50f8",
          storageBucket: "inventario-c50f8.appspot.com",
          messagingSenderId: "369500930345",
          appId: "1:369500930345:web:aee12cb852f5a8711d7738",
          measurementId: "G-5GJP3TWZPC"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        import {getDatabase, ref, child, onValue, get, set, update, remove} from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

        const db = getDatabase();

        //pegar todos os dados da tabela

        let inventario = [];
        let num = 0;
        let tbody = document.getElementById ('tbody1');

        const SelectAllDataOnce = ()=>
        {
            const dbRef = ref(db);
            //rfids é o nome da categoria no firebase
            get(child(dbRef, 'rfids')).then((snapshot)=>{
                inventario = [];
                snapshot.forEach(iid => 
                {
                    inventario.push(iid.val());
                });
                AddAllRecords();
            })
        }

        const SelectAllDataRealtime = ()=>
        {
            const dbRef = ref(db, 'rfids');
            onValue(dbRef,(snapshot)=>
            {
              inventario = [];
                snapshot.forEach(iid => 
                {
                    inventario.push(iid.val());
                });
                AddAllRecords();
            })

        }

        const AddSingleRecord = (Local, Nome, Tag, Patrimonio)=>
        {
            let trow = document.createElement('tr');
            let td1 = document.createElement('td');
            let td2 = document.createElement('td');
            let td3 = document.createElement('td');
            let td4 = document.createElement('td');
            let td5 = document.createElement('td');

            td1.innerHTML = ++num;
            td2.innerHTML = Local;
            td3.innerHTML = Nome;
            td4.innerHTML = Tag;
            td5.innerHTML = Patrimonio;

            trow.append(td1,td2, td3, td4, td5);
            tbody.append(trow);

        }

        const AddAllRecords  = () => 
        {
          num = 0;
          tbody.innerHTML = "";
          inventario.forEach(iid => 
          {
              AddSingleRecord(iid.Local,iid.Nome,iid.Tag,iid.Patrimonio);
          })
        }

        window.addEventListener('load', SelectAllDataRealtime);


      </script>

  </body>
</html>